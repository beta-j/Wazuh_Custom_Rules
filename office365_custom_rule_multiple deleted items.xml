<!-- This is a custom rule for Wazuh to detect logs for multiple "SoftDelete" operations generated by the office365 API integration -->
<!-- The idea is to generate an alert when multiple emails are deleted from a given user's "deleted items" folder in a short time frame -->
<!-- This could indicate a possible account compromise and warrants further inveestigation by the SOC team -->
<group name="office365,">
  <rule id="100005" level="3">  <!-- match on user deletes an email from the deleted items folder - i.e. soft delete -->
    <if_sid>91535</if_sid>
    <field name="office365.Operation">SoftDelete</field>
    <description>Soft delete detected (direct match)</description>
  </rule>
  <rule id="100006" level="8" frequency="5" timeframe="1200">  <!-- generate an alert if more than 5 softdelete events are recorded in 20 minutes-->
    <if_matched_sid>100005</if_matched_sid>
    <same_field>office365.UserId</same_field>
    <description>Several Soft deletes detected from the same user</description>
  </rule>
</group>
